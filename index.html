<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéâ Feliz Anivers√°rio, Maria!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #e63946; /* Vermelho forte */
            --secondary-color: #ff8fa3; /* Vermelho claro */
            --background-start: #ffddd2;
            --background-end: #fff1e6;
            --text-color: #555;
            --white: #ffffff;
            --brown: #7b3f00;
            --table-color: #a0522d;
            --dream-bg-start: #ffafcc;
            --dream-bg-end: #bde0fe;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--background-start), var(--background-end));
            color: var(--text-color);
            padding: 10px;
        }

        .main-container {
            width: 100%;
            max-width: 960px;
            text-align: center;
            transition: transform 0.2s ease-in-out;
        }

        .main-container.shake {
            animation: screen-shake 0.5s ease-in-out;
        }

        @keyframes screen-shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        .screen {
            width: 100%;
            max-width: 960px;
            padding: 20px;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #cutscene-container {
            position: relative;
            height: 500px;
            border: 4px solid var(--secondary-color);
            border-radius: 12px;
            overflow: hidden;
            background-color: #faf0e6;
            transition: background-color 1s ease;
        }
        
        .scene-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0;
            transition: opacity 1.5s ease, transform 1.5s ease;
            background-size: cover;
            background-position: center;
            transform: scale(1.1);
        }
        .scene-bg.active { 
            opacity: 1; 
            transform: scale(1);
        }

        #scene-casa { background-color: #faf0e6; }
        #scene-quarto { background-color: #e0d8f0; }
        #scene-sonho { background: linear-gradient(135deg, var(--dream-bg-start), var(--dream-bg-end)); }
        #scene-festa { background: linear-gradient(135deg, #a2d2ff, #ffc8dd); }

        .character {
            position: absolute;
            bottom: 40px;
            width: 80px;
            height: 110px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.4s ease, filter 0.4s ease, opacity 0.4s ease;
            opacity: 0;
            transform: translateY(20px);
        }

        .character.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .character.speaking {
            transform: translateY(-5px) scale(1.1);
            filter: drop-shadow(0 0 10px var(--white));
        }

        .character .visuals { position: relative; width: 60px; height: 90px; }
        .character .head {
            position: absolute; top: 0; left: 15px; width: 30px; height: 30px;
            border-radius: 50%; background-color: #ffd6e3;
        }
        .eye {
            position: absolute;
            width: 4px; height: 5px;
            background-color: #333;
            border-radius: 50%;
            top: 12px;
            animation: blink 5s infinite random;
        }
        .eye.left { left: 8px; }
        .eye.right { right: 20px; }
        @keyframes blink {
            0%, 95%, 100% { transform: scaleY(1); }
            97% { transform: scaleY(0.1); }
        }

        .character .body {
            position: absolute; bottom: 0; left: 25px; width: 10px; height: 60px;
        }
        .character .hair {
            position: absolute; top: -5px; left: 10px; width: 40px; height: 20px;
            background-color: var(--brown); border-radius: 50% 50% 0 0;
        }
        .name-tag {
            font-size: 0.8em;
            font-weight: 600;
            color: var(--white);
            background-color: rgba(0, 0, 0, 0.5);
            padding: 3px 8px;
            border-radius: 8px;
            margin-top: 5px;
        }

        /* ----- CARACTER√çSTICAS √öNICAS DOS PERSONAGENS ----- */
        #maria { left: 50%; transform: translateX(-50%); } #maria .body { background-color: var(--primary-color); }
        
        #mae { left: 20%; } #mae .body { background-color: #8e44ad; } 
        #mae .hair { background-color: #333; height: 25px; width: 30px; left: 15px; top: -2px; border-radius: 50%; } /* Coque */
        
        #irmao { right: 20%; } #irmao .body { background-color: #2980b9; } 
        #irmao .hair { width: 30px; height: 10px; top: 0; left: 15px; border-radius: 20px; background-color: #5d4037;} /* Cabelo curto */
        
        .dream-char { animation: float 6s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        
        #riam { left: 5%; bottom: 150px; } #riam .body { background-color: #1abc9c; }
        #samuel { left: 20%; bottom: 190px; } #samuel .body { background-color: #e74c3c; } #samuel .hair { background-color: #ff9800; } /* Cabelo Laranja */
        
        #cecilia { left: 35%; bottom: 170px; } #cecilia .body { background-color: #f1c40f; } 
        #cecilia .hair { background-color: #c68642; height: 40px; border-radius: 30% 30% 40% 40%; } /* Cabelo Longo */
        
        #maluhelen { right: 35%; bottom: 180px; } #maluhelen .body { background-color: #9b59b6; } 
        #maluhelen .hair { background-color: #e91e63; height: 30px; width: 30px; left: 15px; border-radius: 50%; } /* Cabelo Redondo */
        
        #vitoria { right: 20%; bottom: 160px; } #vitoria .body { background-color: #3498db; }
        #vitoria .hair { height: 10px; top: 20px; width: 45px; left: 7.5px; border-radius: 0 0 10px 10px; } /* Rabo de cavalo baixo */

        #maira { right: 5%; bottom: 200px; filter: drop-shadow(0 0 10px white); } #maira .body { background-color: var(--white); } #maira .hair { background-color: #fdd835; }

        /* NOVO PERSONAGEM: HYUNJIN */
        #hyunjin { left: 50%; bottom: 220px; transform: translateX(-50%); filter: drop-shadow(0 0 15px #ffffffaa); }
        #hyunjin .body { background-color: #2c3e50; } /* Roupa escura */
        #hyunjin .hair { background-color: #e0e0e0; border-radius: 50% 50% 10% 10%; height: 25px; } /* Cabelo "prateado" */


        .speech-bubble {
            position: absolute; bottom: 220px;
            background: var(--white); padding: 12px 18px; border-radius: 15px;
            border: 2px solid var(--primary-color); font-weight: 600; text-align: left;
            opacity: 0; transform: scale(0.8) translateY(20px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 280px; z-index: 10;
        }
        .speech-bubble .speaker-name {
            display: block; font-weight: 700; color: var(--primary-color); margin-bottom: 5px;
        }
        .speech-bubble.visible { opacity: 1; transform: scale(1) translateY(0); }
        .speech-bubble::after {
            content: ''; position: absolute; top: 100%; left: 50%;
            transform: translateX(-50%); width: 0; height: 0;
            border-left: 10px solid transparent; border-right: 10px solid transparent;
            border-top: 10px solid var(--primary-color);
        }
        .speech-bubble::before {
             content: ''; position: absolute; top: 100%; left: 50%;
            transform: translateX(-50%); width: 0; height: 0;
            border-left: 8px solid transparent; border-right: 8px solid transparent;
            border-top: 8px solid var(--white); margin-top: -1.5px;
        }

        .scene-element { position: absolute; opacity: 0; transition: opacity 1s ease-in-out; }
        #table-element { bottom: 0; left: 50%; transform: translateX(-50%); width: 450px; height: 140px; background-color: var(--table-color); border-top: 10px solid #804020; }
        .table-food { bottom: 140px; font-size: 30px; }
        #cuscuz-food { left: 35%; } #acerola-food { left: 60%; }
        #dream-sign { top: 20px; left: 50%; transform: translateX(-50%); color: var(--white); font-size: 1.5em; font-weight: bold; text-shadow: 2px 2px 4px #00000080; }
        #party-banner { top: 30px; left: 50%; transform: translateX(-50%); font-size: 1.8em; color: var(--primary-color); font-weight: bold; text-shadow: 1px 1px 2px var(--white); }
        #skz-poster {
            width: 60px; height: 90px; background-color: #ffafcc;
            border: 2px solid #333; top: 120px; left: 100px;
            transform: rotate(-5deg); display: flex; align-items: center; justify-content: center;
            font-size: 0.8em; font-weight: bold; color: #333;
        }
        #skz-poster::after { content: "SKZ"; }

        #next-dialogue-btn { margin-top: 15px; }
        
        #head-button {
            width: 150px; height: 150px; background: #ffd6e3;
            border: 4px solid var(--primary-color); border-radius: 50%;
            position: relative; cursor: pointer; margin: 20px auto;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        #head-button:hover { transform: scale(1.1); }
        #head-button.exploding { animation: head-explode 1s forwards ease-in-out; }
        @keyframes head-explode {
            0% { transform: scale(1); }
            20% { transform: scale(1.1) rotate(5deg); }
            40% { transform: scale(0.9) rotate(-5deg); }
            60% { transform: scale(1.2) rotate(10deg); }
            80% { transform: scale(1.5); }
            100% { transform: scale(3); opacity: 0; }
        }
        #head-button .hair {
            content: ''; position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 130px; height: 65px; background-color: var(--brown); border-radius: 70% 70% 20% 20%;
        }

        .photo-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .photo { width: 250px; height: 250px; object-fit: cover; border: 4px solid var(--secondary-color); border-radius: 12px; }
        #typing-text { font-size: 1.2em; color: #d1495b; margin-top: 30px; min-height: 40px; font-weight: 600; text-align: left; max-width: 700px; line-height: 1.6; margin: 30px auto 0 auto; }
        
        button {
            padding: 12px 25px; background: var(--secondary-color); color: var(--white);
            border: none; border-radius: 50px; cursor: pointer; font-weight: bold;
            font-size: 1em; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        button:hover { background: var(--primary-color); transform: translateY(-3px); }
        .hidden { display: none !important; }
        canvas#confetti-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 100; }

        @media (max-width: 768px) {
            .main-container, .screen { padding: 10px; }
            #cutscene-container { height: 70vh; }
            .character { width: 50px; height: 80px; bottom: 20px; }
            .character .visuals { width: 50px; height: 70px; }
            .character .body { height: 40px; left: 20px; }
            .character .hair { left: 5px; }
            .eye { width: 3px; height: 4px; top: 10px; }
            .eye.left { left: 7px; } .eye.right { right: 7px; }
            #irmao .hair, #mae .hair, #maluhelen .hair { left: 10px; }
            
            .character.speaking {
                transform: scale(1.1) translateY(-3px);
            }
            .name-tag { font-size: 0.7em; }
            #mae { left: 5%; }
            #irmao { right: 5%; }

            .speech-bubble {
                max-width: 95vw; font-size: 0.85em; padding: 10px 15px;
                bottom: initial; top: 15px;
            }
            .speech-bubble::after, .speech-bubble::before { display: none; }
            .dream-char { animation: none; }
            
            #maria.in-dream { bottom: 30px; }
            #riam.in-dream { left: 5%; bottom: 250px; }
            #samuel.in-dream { right: 5%; bottom: 250px; }
            #cecilia.in-dream { left: 15%; bottom: 180px; }
            #maluhelen.in-dream { right: 15%; bottom: 180px; }
            #vitoria.in-dream { left: 25%; bottom: 110px; }
            #maira.in-dream { right: 25%; bottom: 110px; }
            /* HYUNJIN NO CELULAR */
            #hyunjin.in-dream { left: 50%; bottom: 300px; transform: translateX(-50%); }
            
            #table-element { width: 100%; height: 100px; }
            .table-food { bottom: 100px; }
            #skz-poster { left: 20px; top: 100px; }
            .photo { width: 200px; height: 200px; }
            #typing-text { font-size: 1em; max-width: 90vw; }
            h1 { font-size: 1.8em; }
        }
    </style>
</head>
<body>

<div class="main-container">
    <div id="start-screen" class="screen">
        <h1>Uma Noite Surpresa</h1>
        <p>Uma hist√≥ria para Maria</p>
        <button id="start-story-btn">Come√ßar</button>
    </div>

    <div id="cutscene-screen" class="screen hidden">
        <div id="cutscene-container">
            <div id="scene-casa" class="scene-bg"></div>
            <div id="scene-quarto" class="scene-bg"></div>
            <div id="scene-sonho" class="scene-bg"></div>
            <div id="scene-festa" class="scene-bg"></div>

            <div id="table-element" class="scene-element"><div id="cuscuz-food" class="table-food">ü•£</div><div id="acerola-food" class="table-food">üçπ</div></div>
            <div id="skz-poster" class="scene-element"></div>
            <div id="dream-sign" class="scene-element">Bem-vinda ao Mundo dos Rescusos</div>
            <div id="party-banner" class="scene-element">Parab√©ns, Maria Cabe√ßuda!</div>

            <div id="maria" class="character"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">Maria</div></div>
            <div id="mae" class="character"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">M√£e</div></div>
            <div id="irmao" class="character"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">Irm√£o</div></div>
            <div id="riam" class="character dream-char"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">Riam</div></div>
            <div id="samuel" class="character dream-char"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">Samuel</div></div>
            <div id="cecilia" class="character dream-char"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">Cec√≠lia</div></div>
            <div id="maluhelen" class="character dream-char"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">Maluhelen</div></div>
            <div id="vitoria" class="character dream-char"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">Vit√≥ria</div></div>
            <div id="maira" class="character dream-char"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">Maira</div></div>
            <div id="hyunjin" class="character dream-char"><div class="visuals"><div class="hair"></div><div class="head"><div class="eye left"></div><div class="eye right"></div></div><div class="body"></div></div><div class="name-tag">Hyunjin</div></div>

            <div id="bubble" class="speech-bubble"></div>
        </div>
        <button id="next-dialogue-btn" class="hidden">Pr√≥ximo ‚Üí</button>
    </div>

    <div id="reward-screen" class="screen hidden">
        <h2 id="reward-title"></h2>
        <div id="head-button"><div class="hair"></div></div>
    </div>

    <div id="surprise-content" class="screen hidden">
        <div id="typing-text"></div>
        <div class="photo-container">
            <img src="https://live.staticflickr.com/65535/54792947163_e94652cdbe_z.jpg" class="photo" alt="Malu, Riam e Maria" onerror="this.onerror=null;this.src='https://placehold.co/250x250/e63946/ffffff?text=Foto';">
            <img src="https://live.staticflickr.com/65535/54795313213_c8b20e0577_z.jpg" class="photo" alt="Maria e Cec√≠lia" onerror="this.onerror=null;this.src='https://placehold.co/250x250/e63946/ffffff?text=Foto';">
        </div>
        <button id="restart-btn" style="margin-top: 20px;">Ver de novo</button>
    </div>
</div>

<canvas id="confetti-canvas"></canvas>

<script>
    const screens = {
        start: document.getElementById('start-screen'),
        cutscene: document.getElementById('cutscene-screen'),
        reward: document.getElementById('reward-screen'),
        surprise: document.getElementById('surprise-content'),
    };

    const buttons = {
        start: document.getElementById('start-story-btn'),
        next: document.getElementById('next-dialogue-btn'),
        head: document.getElementById('head-button'),
        restart: document.getElementById('restart-btn'),
    };
    
    const script = [
        { scene: 1, speaker: 'maria', text: "Que dia, viu... Quase dormi na aula de Filosofia. E a prova de Qu√≠mica? Um desastre." },
        { scene: 1, speaker: 'mae', text: "Minha filha, deixa isso pra l√°. Vem jantar, preparei um cuscuz com tudo que tu gosta." },
        { scene: 1, speaker: 'maria', text: "S√©rio mesmo?! Tem aquele suquinho de acerola?" },
        { scene: 1, speaker: 'mae', text: "Claro. E caf√© passado na hora, viu?" },
        { scene: 1, speaker: 'irmao', text: "S√≥ cuidado pra cabe√ßa dela n√£o bater na mesa. Vai que quebra!" },
        { scene: 1, speaker: 'maria', text: "Vai cuidar da tua careca, que t√° refletindo a luz da l√¢mpada j√°." },
        { scene: 1, speaker: 'irmao', text: "Pelo menos minha cabe√ßa cabe numa foto 3x4, n√©?" },
        { scene: 1, speaker: 'mae', text: "Voc√™s parecem que vivem de stand-up. Sentem e comam logo." },
        { scene: 1, speaker: 'maria', text: "Hoje a Cec√≠lia derrubou um estojo inteiro. A professora s√≥ olhou com aquela cara dela..." },
        { scene: 1, speaker: 'irmao', text: "Aposto que voc√™ riu igual uma foca." },
        { scene: 1, speaker: 'maria', text: "√ìbvio. E a Maluhelen me emprestou uma caneta cheirosa de morango. Achei chique." },
        { scene: 1, speaker: 'mae', text: "E como t√° a professora Maira? Ela falou contigo hoje?" },
        { scene: 1, speaker: 'maria', text: "Falou sim. Disse que eu tava mais focada. Acho que ela gosta de mim de verdade." },
        { scene: 1, speaker: 'irmao', text: "Ela gosta da tua cabe√ßa, isso sim. Cabe todo o conte√∫do da aula." },
        { scene: 1, speaker: 'mae', text: "Filha... sei que √†s vezes sou dura com voc√™, que pego no seu p√©..." },
        { scene: 1, speaker: 'mae', text: "Mas √© porque te amo tanto e me preocupo. S√≥ quero que voc√™ se torne uma grande mulher, a mulher incr√≠vel que sei que voc√™ pode ser." },
        { scene: 1, speaker: 'maria', text: "Eu sei, m√£e. √Äs vezes fico com raiva, mas... eu entendo. Tamb√©m te amo muito, mais que tudo." },
        { scene: 1, speaker: 'mae', text: "Terminou? Agora vai tomar teu banho pra descansar." },
        { scene: 2, text: "(Maria vai para o quarto... tomar um banho e descansar...)" },
        { scene: 3, speaker: 'maria', text: "Oxe... onde √© que eu t√¥? Isso √© um sonho?" },
        { scene: 3, speaker: 'riam', text: "Bem-vinda ao seu pr√≥prio sonho, cabe√ßuda! A gente invadiu sua mente." },
        { scene: 3, speaker: 'samuel', text: "Voc√™ achou mesmo que a gente ia deixar passar o seu anivers√°rio assim?" },
        { scene: 3, speaker: 'cecilia', text: "A gente te ama, Maria. E tamb√©m ama rir de voc√™. (risos)" },
        { scene: 3, speaker: 'maluhelen', text: "E lembra da caneta cheirosa? Pois √©, esse sonho tamb√©m tem cheiro de morango!" },
        { scene: 3, speaker: 'vitoria', text: "Voc√™ sempre ilumina nossos dias, mesmo quando tenta esconder com sarcasmo." },
        { scene: 3, speaker: 'maira', text: "Maria... voc√™ tem um brilho que n√£o pode ser ignorado. Voc√™ me inspira." },
        { scene: 3, speaker: 'maria', text: "Eu n√£o acredito... voc√™s fizeram isso tudo... por mim?" },
        { scene: 3, speaker: 'riam', text: "Por voc√™ a gente faz qualquer coisa. Sua amizade √© importante pra todos n√≥s." },
        // DI√ÅLOGO COM HYUNJIN CORRIGIDO
        { scene: 3, speaker: 'maria', text: "Espera... aquela luz... HYUNJIN?! N√£o pode ser... eu t√¥ sonhando mesmo!" },
        { scene: 3, speaker: 'maria', text: "Eu... eu te amo! O Stray Kids √© tudo pra mim!" },
        { scene: 3, speaker: 'hyunjin', text: "N√≥s tamb√©m amamos voc√™s. F√£s como voc√™ s√£o o motivo de tudo que fazemos." },
        { scene: 3, speaker: 'hyunjin', text: "Fiquei sabendo que √© seu anivers√°rio. Parab√©ns, Maria!" },
        { scene: 3, speaker: 'maria', text: "Voc√™ sabe meu nome?! Ai meu Deus..." },
        { scene: 3, speaker: 'hyunjin', text: "Claro. Hoje o dia √© todo seu. Aproveite cada momento." },
        { scene: 3, speaker: 'hyunjin', text: "Seus amigos me disseram o quanto voc√™ √© especial. Continue sendo essa f√£ incr√≠vel." },
        { scene: 3, speaker: 'riam', text: "E isso nem √© tudo. √â s√≥ o come√ßo. Espere at√© ver o presente de verdade." },
        { scene: 4, speaker: 'riam', text: "Agora... clica ali naquele bot√£o‚Ä¶ e estoura essa cabe√ßa gigante!" },
    ];

    let scriptIndex = 0;
    let currentScene = 0;

    function showScreen(screenName) {
        Object.values(screens).forEach(s => s.classList.add('hidden'));
        screens[screenName].classList.remove('hidden');
    }

    function setupScene(sceneId) {
        if (currentScene === sceneId) return;
        currentScene = sceneId;

        document.querySelectorAll('.scene-bg').forEach(bg => bg.classList.remove('active'));
        document.querySelectorAll('.scene-element').forEach(el => el.style.opacity = '0');
        const allChars = document.querySelectorAll('.character');
        allChars.forEach(ch => {
            ch.classList.remove('visible');
            ch.classList.remove('in-dream'); 
        });


        if (sceneId === 1) { // Casa
            document.getElementById('scene-casa').classList.add('active');
            document.getElementById('table-element').style.opacity = '1';
            ['maria', 'mae', 'irmao'].forEach(id => document.getElementById(id).classList.add('visible'));
        } else if (sceneId === 2) { // Quarto
            document.getElementById('scene-quarto').classList.add('active');
            document.getElementById('skz-poster').style.opacity = '1';
            document.getElementById('maria').classList.add('visible'); 
        } else if (sceneId === 3 || sceneId === 4) { // Sonho e Festa
            const sceneName = sceneId === 3 ? 'sonho' : 'festa';
            const elementName = sceneId === 3 ? 'dream-sign' : 'party-banner';
            document.getElementById(`scene-${sceneName}`).classList.add('active');
            document.getElementById(elementName).style.opacity = '1';
            const dreamChars = ['maria', 'riam', 'samuel', 'cecilia', 'maluhelen', 'vitoria', 'maira', 'hyunjin'];
            dreamChars.forEach(id => {
                const el = document.getElementById(id);
                el.classList.add('visible');
                el.classList.add('in-dream'); 
            });
        }
    }
    
    function updateDialogue() {
        document.querySelectorAll('.character').forEach(ch => ch.classList.remove('speaking'));

        const line = script[scriptIndex];
        if (!line) {
            buttons.next.classList.add('hidden');
            document.getElementById('reward-title').innerText = "Estoure a Cabe√ßa!";
            showScreen('reward');
            return;
        }

        setupScene(line.scene);
        const bubble = document.getElementById('bubble');
        bubble.classList.remove('visible');

        setTimeout(() => {
            const container = document.getElementById('cutscene-container');
            const containerPadding = 15;
            
            if (line.speaker) {
                const speakerEl = document.getElementById(line.speaker);
                const speakerName = speakerEl.querySelector('.name-tag').innerText;
                bubble.innerHTML = `<strong class="speaker-name">${speakerName}</strong><span>${line.text}</span>`;
                speakerEl.classList.add('speaking');
            } else {
                bubble.innerHTML = `<span>${line.text}</span>`;
            }

            bubble.style.transform = 'translateX(0)';

            if (line.speaker && window.innerWidth > 768) {
                const speakerEl = document.getElementById(line.speaker);
                const speakerRect = speakerEl.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();
                
                const speakerCenter = speakerRect.left + speakerRect.width / 2;
                const bubbleWidth = bubble.offsetWidth;
                let bubbleLeft = (speakerCenter - containerRect.left) - (bubbleWidth / 2);

                if (bubbleLeft < containerPadding) bubbleLeft = containerPadding;
                if (bubbleLeft + bubbleWidth > container.offsetWidth - containerPadding) {
                    bubbleLeft = container.offsetWidth - bubbleWidth - containerPadding;
                }
                bubble.style.left = `${bubbleLeft}px`;
            } else { 
                bubble.style.left = '50%';
                bubble.style.transform = 'translateX(-50%)';
            }
            
            bubble.classList.add('visible');
            scriptIndex++;
        }, 200);
    }
    
    function startStory() {
        scriptIndex = 0;
        currentScene = 0;
        document.querySelectorAll('.character').forEach(ch => ch.classList.remove('visible'));
        showScreen('cutscene');
        buttons.next.classList.remove('hidden');
        updateDialogue();
    }
    
    function showFinalSurprise() {
        document.querySelector('.main-container').classList.add('shake');
        buttons.head.classList.add('exploding');
        
        setTimeout(() => {
            document.querySelector('.main-container').classList.remove('shake');
            showScreen('surprise');
            document.body.style.background = 'var(--white)';
            const text = `Feliz anivers√°rio, Maria Cabe√ßuda.\nEu n√£o sou o tipo de pessoa que costuma escrever cartas assim.\n\nNormalmente, n√£o me envolvo, n√£o me empolgo com datas, e n√£o fico pensando em sentimentos ou expectativas.\n\nMas hoje, de algum jeito, voc√™ merece que eu escreva.\nMesmo que a gente n√£o se conhe√ßa profundamente, voc√™ conseguiu se destacar.\n\nE n√£o foi por esfor√ßo, nem por tentar chamar aten√ß√£o. Foi s√≥ voc√™ sendo voc√™ ‚Äî espont√¢nea, divertida e √∫nica.\nTem pequenas coisas suas que sempre me chamaram aten√ß√£o:\n\nO bocejo de Demogorgon que voc√™ solta, imposs√≠vel de esquecer e imposs√≠vel de n√£o rir;\nAqueles gritos inesperados que aparecem do nada, que parecem exagerados, mas acabam virando piadas depois;\nO jeito que voc√™ fala sobre si mesma, como se estivesse narrando epis√≥dios da sua pr√≥pria s√©rie;\nA forma como voc√™ se dedica √† maquiagem, escolhendo cores e detalhes que mostram que voc√™ se conhece e gosta de se expressar;\nSeu humor leve, que n√£o for√ßa nada, que simplesmente acontece;\nE a educa√ß√£o e simpatia que voc√™ demonstra mesmo quando ningu√©m exige isso.\nEu gosto de perceber quando algo te incomoda ou te deixa feliz.\n\nMesmo que voc√™ n√£o perceba, me afeta te ver triste ou cabisbaixa.\n\nQuero ajudar, perguntar como voc√™ est√° ou animar voc√™, mas sem invadir seu espa√ßo.\n\neu fico torcendo para que voc√™ se sinta melhor, mesmo que eu n√£o diga nada.\n\nVer voc√™ triste me deixa estranho de um jeito que n√£o sei explicar, talvez seja porque eu sei como √© ruim isso. N√£o √© sofrimento, √© s√≥ o reconhecimento de que voc√™ merece momentos mais leves, alegria e pequenas coisas que fa√ßam sorrir.\nMesmo sem muitos momentos juntos, foi bom conversar com voc√™. Poucas palavras, mas que tiveram efeito. Isso j√° diz muito sobre voc√™.\nEu gosto de como voc√™ √©.\n\nGosto da autenticidade que voc√™ mant√©m em qualquer situa√ß√£o.\n\nGosto de como consegue ser divertida sem esfor√ßo, e como pequenas coisas que voc√™ faz acabam ficando na mem√≥ria.\nTamb√©m n√£o posso deixar de falar da sua cabe√ßa gigante. üòÜ √â inevit√°vel continuar zoando. Mas mesmo nas brincadeiras, voc√™ tem meu respeito.\nEu n√£o crio expectativas para a vida. N√£o sou movido por sonhos grandiosos. N√£o me apego a pessoas facilmente.\n\nMas reconhe√ßo valor quando vejo, e voc√™ tem valor.\nVoc√™ merece coisas boas. Merece alcan√ßar o que deseja, ser feliz, ter pessoas sinceras ao seu redor, e continuar sendo exatamente quem √©.\nSe algum dia voc√™ precisar de algu√©m ‚Äî para conversar, desabafar, passar o tempo, escolher algo ou s√≥ estar junto de algu√©m que n√£o vai te julgar ‚Äî estarei aqui. Pode ser amanh√£, daqui a cinco anos, ou daqui a dez.\nObrigado por existir, por ser aut√™ntica, divertida, inteligente, educada e sincera.\n\nVoc√™ deixou uma marca ‚Äî pequena para alguns, grande para mim.\n‚Äì E s√≥ para fechar, o certo √© recursos, n√£o rescusos. Continuo lembrando voc√™ disso. üòÜ\n\nRiam Miguel`;
            const typingText = document.getElementById('typing-text');
            
            const formattedText = text.replace(/\n/g, '<br>');
            let j = 0;
            typingText.innerHTML = '';
            
            function typeWriter() {
                if (j < formattedText.length) {
                    if (formattedText.substring(j, j + 4) === '<br>') {
                        typingText.innerHTML += '<br>';
                        j += 4;
                    } else {
                        typingText.innerHTML += formattedText.charAt(j);
                        j++;
                    }
                    setTimeout(typeWriter, 30);
                }
            }
            typeWriter();

            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            let particles = [];
            const items = ["#e63946", "#ff8fa3", "#ffb3c1", "ü•£", "ü•≠"];
            for(let i=0; i<200; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    size: Math.random() * 15 + 10,
                    item: items[Math.floor(Math.random() * items.length)],
                    velocity: { x: Math.random() * 4 - 2, y: Math.random() * 5 + 2 }
                });
            }
            function animateConfetti() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach((p, i) => {
                    p.y += p.velocity.y;
                    p.x += p.velocity.x;
                    if (p.item.startsWith("#")) {
                        ctx.fillStyle = p.item;
                        ctx.fillRect(p.x, p.y, p.size, p.size);
                    } else {
                        ctx.font = `${p.size}px Arial`;
                        ctx.fillText(p.item, p.x, p.y);
                    }
                    if (p.y > canvas.height + 20) particles.splice(i, 1);
                });
                if (particles.length > 0) requestAnimationFrame(animateConfetti);
            }
            animateConfetti();
        }, 800);
    }

    buttons.start.addEventListener('click', startStory);
    buttons.next.addEventListener('click', updateDialogue);
    buttons.head.addEventListener('click', showFinalSurprise);
    buttons.restart.addEventListener('click', () => {
        showScreen('start');
        document.body.style.background = `linear-gradient(135deg, var(--background-start), var(--background-end))`;
        buttons.head.classList.remove('exploding');
    });

</script>
</body>
</html>

